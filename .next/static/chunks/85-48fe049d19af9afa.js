"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{2722:(e,t,r)=>{r.d(t,{A:()=>A});var s=r(5155),a=r(2115),o=r(8173),i=r.n(o),n=r(6046),l=r(6507),c=r(6233),d=r(2823),h=r(1466),u=r(8236);function m(e){let{collapsed:t,setCollapsed:r}=e,a=(0,n.usePathname)(),o=[{name:"Dashboard",href:"/dashboard",icon:l.A},{name:"Subscriptions",href:"/subscriptions",icon:c.A},{name:"Pools",href:"/pools",icon:d.A},{name:"Profile",href:"/profile",icon:h.A},{name:"Settings",href:"/settings",icon:u.A}],m=e=>a===e||a.startsWith("".concat(e,"/"));return(0,s.jsxs)("aside",{className:"bg-gray-900 ".concat(t?"w-20":"w-64"," flex-shrink-0 border-r border-gray-800 h-full transition-all duration-300 ease-in-out flex flex-col"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center h-16 border-b border-gray-800",children:(0,s.jsx)("div",{className:"flex items-center ".concat(t?"justify-center":"justify-start pl-6"),children:(0,s.jsx)("div",{className:"text-purple-500 font-bold text-xl",children:t?"SS":"SubSplitter"})})}),(0,s.jsx)("nav",{className:"mt-6 flex-1",children:(0,s.jsx)("ul",{className:"space-y-2 px-3",children:o.map(e=>(0,s.jsx)("li",{children:(0,s.jsx)(i(),{href:e.href,passHref:!0,children:(0,s.jsxs)("div",{className:"flex items-center px-3 py-3 rounded-md transition-colors duration-200 ".concat(m(e.href)?"bg-purple-600 bg-opacity-20 text-purple-400":"text-gray-400 hover:bg-gray-800 hover:text-white"),children:[(0,s.jsx)(e.icon,{size:20}),!t&&(0,s.jsx)("span",{className:"ml-4",children:e.name})]})})},e.name))})}),(0,s.jsx)("div",{className:"p-4 border-t border-gray-800",children:(0,s.jsx)("button",{onClick:()=>r(!t),className:"w-full flex items-center justify-center p-2 text-gray-400 hover:text-white transition-colors duration-200",children:t?"→":"←"})})]})}var p=r(6710),x=r(767),f=r(853),g=r(5288),v=r(5491),j=r(5236),b=r(1291);function y(){let[e,t]=(0,a.useState)(!1),r=(0,a.useRef)(null),{user:o,logout:n}=(0,b.yg)();return(0,a.useEffect)(()=>{function e(e){r.current&&!r.current.contains(e.target)&&t(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[r]),(0,s.jsxs)("div",{className:"relative",ref:r,children:[(0,s.jsxs)("button",{onClick:()=>t(!e),className:"flex items-center space-x-2 focus:outline-none",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center text-white font-medium",children:(null==o?void 0:o.picture)?(0,s.jsx)("img",{src:o.picture,alt:(null==o?void 0:o.given_name)||"User",className:"w-8 h-8 rounded-full"}):o&&o.given_name?[o.given_name,o.family_name].filter(Boolean).map(e=>(null==e?void 0:e[0])||"").join(""):"U"}),(0,s.jsx)("span",{className:"hidden md:block text-sm font-medium",children:(null==o?void 0:o.given_name)?"".concat(o.given_name," ").concat(o.family_name||""):"Guest"})]}),e&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-56 bg-gray-800 border border-gray-700 rounded-md shadow-lg py-1 z-10",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-gray-700",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:(null==o?void 0:o.given_name)?"".concat(o.given_name," ").concat(o.family_name||""):"Guest"}),(0,s.jsx)("p",{className:"text-xs text-gray-400 truncate",children:(null==o?void 0:o.email)||""})]}),(0,s.jsx)(i(),{href:"/profile",passHref:!0,children:(0,s.jsxs)("div",{className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 flex items-center",children:[(0,s.jsx)(v.A,{size:16,className:"mr-2"}),(0,s.jsx)("span",{children:"Your Profile"})]})}),(0,s.jsx)(i(),{href:"/subscriptions",passHref:!0,children:(0,s.jsxs)("div",{className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 flex items-center",children:[(0,s.jsx)(c.A,{size:16,className:"mr-2"}),(0,s.jsx)("span",{children:"Your Subscriptions"})]})}),(0,s.jsx)(i(),{href:"/settings",passHref:!0,children:(0,s.jsxs)("div",{className:"block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 flex items-center",children:[(0,s.jsx)(u.A,{size:16,className:"mr-2"}),(0,s.jsx)("span",{children:"Settings"})]})}),(0,s.jsx)("div",{className:"border-t border-gray-700 mt-1 pt-1",children:(0,s.jsxs)("button",{onClick:()=>{n()},className:"block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 flex items-center",children:[(0,s.jsx)(j.A,{size:16,className:"mr-2"}),(0,s.jsx)("span",{children:"Sign out"})]})})]})]})}function w(e){let{sidebarCollapsed:t,toggleSidebar:r}=e,[o,i]=(0,a.useState)(!1),[n,l]=(0,a.useState)(!1),[c,d]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{l(!0),d(window.innerWidth>=768);let e=()=>{d(window.innerWidth>=768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.jsxs)("header",{className:"h-16 bg-gray-900 border-b border-gray-800 flex items-center justify-between px-6",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-white mr-4 lg:hidden",children:t?(0,s.jsx)(p.A,{size:20}):(0,s.jsx)(x.A,{size:20})}),(0,s.jsx)("div",{className:"relative ".concat(o?"w-64":"w-auto"," md:w-64 transition-all duration-300"),children:n&&(o||c)?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search...",className:"w-full bg-gray-800 text-gray-200 rounded-md py-2 pl-10 pr-4 focus:outline-none focus:ring-1 focus:ring-purple-500 text-sm"}),(0,s.jsx)(f.A,{size:16,className:"absolute left-3 top-2.5 text-gray-400"})]}):(0,s.jsx)("button",{onClick:()=>i(!0),className:"text-gray-400 hover:text-white",children:(0,s.jsx)(f.A,{size:20})})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("button",{className:"relative text-gray-400 hover:text-white",children:[(0,s.jsx)(g.A,{size:20}),(0,s.jsx)("span",{className:"absolute -top-1 -right-1 bg-purple-500 rounded-full w-4 h-4 flex items-center justify-center text-xs",children:"2"})]}),(0,s.jsx)(y,{})]})]})}var N=r(9002),S=r.n(N);function A(e){let{children:t}=e,[r,o]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"flex h-screen bg-gray-950 text-white ".concat(S().className),children:[(0,s.jsx)(m,{collapsed:r,setCollapsed:o}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden",children:[(0,s.jsx)(w,{sidebarCollapsed:r,toggleSidebar:()=>o(!r)}),(0,s.jsx)("main",{className:"flex-1 overflow-y-auto p-6 bg-gradient-to-br from-gray-900 to-gray-950",children:t})]})]})}},7568:(e,t,r)=>{r.d(t,{U:()=>o});var s=r(2818);class a{async getUserPools(){try{let e=await fetch("/api/auth");if(!e.ok)throw Error("Failed to get authentication token");let{accessToken:t}=await e.json(),r=await fetch("".concat(this.apiUrl,"/pool-members/current-user"),{headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("API error: ".concat(r.status));let s=await r.json();return console.log("User Pools Data:",s),s.map(e=>({poolId:e.poolId,name:e.name||"Subscription Pool",serviceId:e.serviceId,slotsTotal:e.slotsTotal,slotsAvailable:e.slotsAvailable,costPerSlot:e.costPerSlot,membershipStatus:{paymentStatus:"paid",accessStatus:e.isActive?"active":"inactive",joinedAt:e.createdAt}}))}catch(e){return console.error("Error fetching user pools:",e),[]}}async getServiceInfo(e){if(this.serviceCache.has(e))return this.serviceCache.get(e);try{let t=await fetch("".concat(this.apiUrl,"/subscription-services/").concat(e));if(!t.ok)throw Error("API error: ".concat(t.status));let r=await t.json(),s={id:e,name:r.name||"Subscription Service",logoUrl:r.logoUrl||"/assets/logos/default.svg",color:r.color||"#6366f1"};return this.serviceCache.set(e,s),s}catch(t){return console.error("Error fetching service ".concat(e,":"),t),{id:e,name:"Subscription Service",logoUrl:"/assets/logos/default.svg",color:"#6366f1"}}}async getAllPools(){try{let e=await fetch("".concat(this.apiUrl,"/subscriptions"));if(!e.ok)throw Error("API error: ".concat(e.status));let t=await e.json();if(console.log("API Data:",t),!t||0===t.length)return console.log("No pools returned from API"),[];return await this.transformPools(t)}catch(e){throw console.error("Error fetching pools:",e),e}}async createPool(e){try{let t=await fetch("/api/auth");if(!t.ok)throw Error("Failed to get authentication token");let{accessToken:r}=await t.json();if(!r)throw Error("Authentication token not found");let s={serviceId:e.serviceId,name:e.name,encryptedCredentials:e.encryptedCredentials,slotsTotal:e.slotsTotal,costPerSlot:e.costPerSlot.toString(),isActive:!0,region:null},a=await fetch("".concat(this.apiUrl,"/subscriptions"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify(s)});if(!a.ok)throw Error("API error: ".concat(a.status));let o=await a.json();return console.log("Create Pool Response:",o),(await this.transformPools([o]))[0]}catch(e){throw console.error("Error creating pool:",e),e}}async joinPool(e){try{let t=await fetch("/api/auth");if(!t.ok)throw Error("Failed to get authentication token");let{accessToken:r}=await t.json(),s=await fetch("".concat(this.apiUrl,"/subscriptions/").concat(e,"/join"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}});if(!s.ok){let e=await s.json();if(e.message&&e.message.includes("already a member"))throw Error("You have already joined this subscription pool");throw Error("API error: ".concat(s.status))}}catch(e){throw console.error("Error joining pool:",e),e}}async leavePool(e){try{let t=await fetch("/api/auth");if(!t.ok)throw Error("Failed to get authentication token");let{accessToken:r}=await t.json(),s=await fetch("".concat(this.apiUrl,"/subscriptions/").concat(e,"/leave"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}});if(!s.ok)throw Error("API error: ".concat(s.status))}catch(e){throw console.error("Error leaving pool:",e),e}}async transformPools(e){let t=e.map(e=>this.getServiceInfo(e.serviceId)),r=await Promise.all(t),s=new Map;return r.forEach(e=>s.set(e.id,e)),e.map(e=>{let t=new Date,r=new Date(t);r.setMonth(t.getMonth()+1);let a={id:e.userId,name:"Pool Creator",isPrimary:!0},o=s.get(e.serviceId)||{id:e.serviceId,name:e.name||"Subscription Service",logoUrl:"/assets/logos/default.svg",color:"#6366f1"};return{id:e.poolId,serviceName:o.name,serviceLogo:o.logoUrl,serviceColor:o.color,plan:"Standard Plan",totalCost:parseFloat(e.costPerSlot)*e.slotsTotal,splitCost:parseFloat(e.costPerSlot),members:[a],capacity:e.slotsTotal,slotsAvailable:e.slotsAvailable,expiresAt:r.toISOString(),status:e.isActive?"active":"expired",lastPayment:e.updatedAt}})}constructor(){this.apiUrl=s.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",this.serviceCache=new Map}}let o=new a}}]);