"use strict";exports.id=286,exports.ids=[286],exports.modules={4849:(e,s,t)=>{t.d(s,{A:()=>r});let r=(0,t(1680).A)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},6201:(e,s,t)=>{t.d(s,{A:()=>r});let r=(0,t(1680).A)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]])},6235:(e,s,t)=>{t.d(s,{A:()=>r});let r=(0,t(1680).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},8741:(e,s,t)=>{t.d(s,{A:()=>r});let r=(0,t(1680).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2610:(e,s,t)=>{t.d(s,{A:()=>p});var r=t(5512),o=t(8009),l=t(5103),a=t(4977),i=t(5402),n=t(4269),c=t(6235),d=t(4849),h=t(6201);let m=(0,t(1680).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function x({poolId:e,poolName:s,costPerMonth:t,isOpen:l,onClose:a,onSuccess:x}){let[u,p]=(0,o.useState)("idle"),[g,b]=(0,o.useState)(""),j=async()=>{try{p("loading"),await i.U.joinPool(e),p("success"),setTimeout(()=>{x(),a()},1500)}catch(e){console.error("Error joining pool:",e),e.message&&e.message.toLowerCase().includes("already a member")?p("already-joined"):(b(e.message||"Failed to join pool. Please try again later."),p("error"))}};return l?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-xl max-w-md w-full overflow-hidden shadow-xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"already-joined"===u?"Already a Member":"Join Subscription Pool"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-white",disabled:"loading"===u,children:(0,r.jsx)(n.A,{size:20})})]}),(0,r.jsxs)("div",{className:"p-6",children:["idle"===u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"mb-4",children:["You're about to join the ",(0,r.jsx)("span",{className:"font-medium",children:s})," subscription pool."]}),(0,r.jsxs)("div",{className:"bg-gray-900 rounded-lg p-4 mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("span",{className:"text-gray-400",children:"Your monthly cost:"}),(0,r.jsxs)("span",{className:"text-lg font-bold text-green-400",children:["$",t.toFixed(2)]})]}),(0,r.jsx)("div",{className:"text-sm text-gray-400",children:"You'll be charged when the subscription renews. You can leave the pool anytime before the renewal date."})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:j,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors",children:"Join Pool"})]})]}),"loading"===u&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)(c.A,{size:36,className:"animate-spin mx-auto text-purple-500 mb-4"}),(0,r.jsx)("p",{children:"Joining pool..."}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"This will only take a moment"})]}),"success"===u&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(d.A,{size:32,className:"text-green-400"})}),(0,r.jsx)("h4",{className:"text-xl font-semibold mb-2",children:"Successfully Joined!"}),(0,r.jsxs)("p",{className:"text-gray-400",children:["You are now a member of the ",s," pool"]})]}),"already-joined"===u&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(h.A,{size:32,className:"text-blue-400"})}),(0,r.jsx)("h4",{className:"text-xl font-semibold mb-2 text-blue-400",children:"Already a Member"}),(0,r.jsxs)("p",{className:"text-gray-400 mb-4",children:["You're already a member of this subscription pool.",(0,r.jsx)("br",{}),(0,r.jsxs)("span",{className:"block mt-2",children:["Check your active memberships to access ",s,"."]})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:"Got It"})})]}),"error"===u&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(m,{size:32,className:"text-red-400"})}),(0,r.jsx)("h4",{className:"text-xl font-semibold mb-2 text-red-400",children:"Error"}),(0,r.jsx)("p",{className:"text-gray-400 mb-4",children:g}),(0,r.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,r.jsx)("button",{onClick:a,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{p("idle"),b("")},className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors",children:"Try Again"})]})]})]})]})}):null}function u({poolId:e,poolName:s,isOpen:t,onClose:l,onSuccess:a}){let[i,h]=(0,o.useState)("idle"),[x,u]=(0,o.useState)(""),p=async()=>{try{h("loading"),a(),h("success"),setTimeout(()=>{l()},1500)}catch(e){console.error("Error leaving pool:",e),u(e.message||"Failed to leave pool. Please try again later."),h("error")}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-gray-800 rounded-xl max-w-md w-full overflow-hidden shadow-xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Leave Subscription Pool"}),(0,r.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-white",disabled:"loading"===i,children:(0,r.jsx)(n.A,{size:20})})]}),(0,r.jsxs)("div",{className:"p-6",children:["idle"===i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{className:"mb-4",children:["Are you sure you want to leave the ",(0,r.jsx)("span",{className:"font-medium",children:s})," subscription pool?"]}),(0,r.jsx)("div",{className:"bg-gray-900 rounded-lg p-4 mb-6",children:(0,r.jsxs)("div",{className:"text-sm text-gray-400",children:[(0,r.jsx)("p",{children:"When you leave a pool:"}),(0,r.jsxs)("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:[(0,r.jsx)("li",{children:"You'll lose access to the subscription immediately"}),(0,r.jsx)("li",{children:"You won't be charged in future billing cycles"}),(0,r.jsx)("li",{children:"No refunds are provided for the current billing period"})]})]})}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:p,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Leave Pool"})]})]}),"loading"===i&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)(c.A,{size:36,className:"animate-spin mx-auto text-purple-500 mb-4"}),(0,r.jsx)("p",{children:"Processing your request..."}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"This will only take a moment"})]}),"success"===i&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(d.A,{size:32,className:"text-green-400"})}),(0,r.jsx)("h4",{className:"text-xl font-semibold mb-2",children:"Successfully Left Pool"}),(0,r.jsxs)("p",{className:"text-gray-400",children:["You've been removed from the ",s," pool"]})]}),"error"===i&&(0,r.jsxs)("div",{className:"text-center py-6",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(m,{size:32,className:"text-red-400"})}),(0,r.jsx)("h4",{className:"text-xl font-semibold mb-2 text-red-400",children:"Error"}),(0,r.jsx)("p",{className:"text-gray-400 mb-4",children:x}),(0,r.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,r.jsx)("button",{onClick:l,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:()=>{h("idle"),u("")},className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Try Again"})]})]})]})]})}):null}function p({pool:e,onClick:s,onJoin:t,onLeave:i,currentUserId:n}){let[c,d]=(0,o.useState)(!1),[h,m]=(0,o.useState)(!1),p=e.slotsAvailable,g=new Date(e.expiresAt).toLocaleDateString(),b=(e.totalCost/e.capacity*(e.capacity-1)/e.totalCost*100).toFixed(0),j=e.isUserMember||e.members.some(e=>e.id===n);return console.log("Pool:",e.serviceName,"- isUserMember:",j),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"bg-gray-800 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-lg hover:translate-y-[-4px] cursor-pointer border border-gray-700",onClick:s,children:[(0,r.jsx)("div",{className:"h-1",style:{backgroundColor:e.serviceColor}}),(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsxs)("div",{className:"flex items-center mb-5",children:[(0,r.jsx)("div",{className:"h-12 w-12 relative rounded-lg overflow-hidden bg-gray-900",children:(0,r.jsx)(l.default,{src:e.serviceLogo,alt:e.serviceName,layout:"fill",objectFit:"cover",onError:e=>{let s=e.target;s.onerror=null,s.src="/assets/logos/default.svg"}})}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[(0,r.jsx)("h3",{className:"text-lg font-bold",children:e.serviceName}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("p",{className:"text-gray-400 text-xs",children:["Renews on ",g]}),(0,r.jsxs)("div",{className:"bg-green-900/30 text-green-400 text-xs px-2 py-1 rounded-full",children:["Save ",b,"%"]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mb-5 bg-gray-900 rounded-lg p-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Total"}),(0,r.jsxs)("div",{className:"text-lg font-bold",children:["$",e.totalCost.toFixed(2)]})]}),(0,r.jsx)("div",{className:"text-gray-400",children:(0,r.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M5 12H19M19 12L13 6M19 12L13 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Your share"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-green-400",children:["$",e.splitCost.toFixed(2)]})]})]}),(0,r.jsxs)("div",{className:"mb-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-gray-300",children:[(0,r.jsx)(a.A,{size:14,className:"inline mr-1 text-gray-400"}),"Members"]}),(0,r.jsxs)("div",{className:"text-sm bg-gray-700 px-2 py-1 rounded-full",children:[e.capacity-e.slotsAvailable,"/",e.capacity]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-1.5",children:(0,r.jsx)("div",{className:"bg-purple-600 h-1.5 rounded-full",style:{width:`${(e.capacity-e.slotsAvailable)/e.capacity*100}%`}})})]}),j?(0,r.jsx)("button",{className:"w-full py-2.5 px-4 rounded-lg font-medium flex items-center justify-center transition duration-200 bg-gray-700 hover:bg-gray-600 text-white",onClick:e=>{e.stopPropagation(),m(!0)},children:"Leave Pool"}):(0,r.jsx)("button",{className:`w-full py-2.5 px-4 rounded-lg font-medium flex items-center justify-center transition duration-200 ${p>0?"bg-purple-600 hover:bg-purple-700 text-white":"bg-gray-700 text-gray-400 cursor-not-allowed"}`,disabled:0===p,onClick:e=>{e.stopPropagation(),d(!0)},children:p>0?`Join Pool (${p} ${1===p?"spot":"spots"} left)`:"Pool is Full"})]})]}),(0,r.jsx)(x,{poolId:e.id,poolName:e.serviceName,costPerMonth:e.splitCost,isOpen:c,onClose:()=>d(!1),onSuccess:()=>{t&&t()}}),(0,r.jsx)(u,{poolId:e.id,poolName:e.serviceName,isOpen:h,onClose:()=>m(!1),onSuccess:()=>{i&&i()}})]})}},5402:(e,s,t)=>{t.d(s,{U:()=>o});class r{constructor(){this.apiUrl=process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",this.serviceCache=new Map}async getUserPools(){try{let e=await fetch("/api/auth");if(!e.ok)throw Error("Failed to get authentication token");let{accessToken:s}=await e.json(),t=await fetch(`${this.apiUrl}/pool-members/current-user`,{headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw Error(`API error: ${t.status}`);let r=await t.json();return console.log("User Pools Data:",r),r.map(e=>({poolId:e.poolId,name:e.name||"Subscription Pool",serviceId:e.serviceId,slotsTotal:e.slotsTotal,slotsAvailable:e.slotsAvailable,costPerSlot:e.costPerSlot,membershipStatus:{paymentStatus:"paid",accessStatus:e.isActive?"active":"inactive",joinedAt:e.createdAt}}))}catch(e){return console.error("Error fetching user pools:",e),[]}}async getServiceInfo(e){if(this.serviceCache.has(e))return this.serviceCache.get(e);try{let s=await fetch(`${this.apiUrl}/subscription-services/${e}`);if(!s.ok)throw Error(`API error: ${s.status}`);let t=await s.json(),r={id:e,name:t.name||"Subscription Service",logoUrl:t.logoUrl||"/assets/logos/default.svg",color:t.color||"#6366f1"};return this.serviceCache.set(e,r),r}catch(s){return console.error(`Error fetching service ${e}:`,s),{id:e,name:"Subscription Service",logoUrl:"/assets/logos/default.svg",color:"#6366f1"}}}async getAllPools(){try{let e=await fetch(`${this.apiUrl}/subscriptions`);if(!e.ok)throw Error(`API error: ${e.status}`);let s=await e.json();if(console.log("API Data:",s),!s||0===s.length)return console.log("No pools returned from API"),[];return await this.transformPools(s)}catch(e){throw console.error("Error fetching pools:",e),e}}async createPool(e){try{let s=await fetch("/api/auth");if(!s.ok)throw Error("Failed to get authentication token");let{accessToken:t}=await s.json();if(!t)throw Error("Authentication token not found");let r={serviceId:e.serviceId,name:e.name,encryptedCredentials:e.encryptedCredentials,slotsTotal:e.slotsTotal,costPerSlot:e.costPerSlot.toString(),isActive:!0,region:null},o=await fetch(`${this.apiUrl}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(r)});if(!o.ok)throw Error(`API error: ${o.status}`);let l=await o.json();return console.log("Create Pool Response:",l),(await this.transformPools([l]))[0]}catch(e){throw console.error("Error creating pool:",e),e}}async joinPool(e){try{let s=await fetch("/api/auth");if(!s.ok)throw Error("Failed to get authentication token");let{accessToken:t}=await s.json(),r=await fetch(`${this.apiUrl}/subscriptions/${e}/join`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!r.ok){let e=await r.json();if(e.message&&e.message.includes("already a member"))throw Error("You have already joined this subscription pool");throw Error(`API error: ${r.status}`)}}catch(e){throw console.error("Error joining pool:",e),e}}async leavePool(e){try{let s=await fetch("/api/auth");if(!s.ok)throw Error("Failed to get authentication token");let{accessToken:t}=await s.json(),r=await fetch(`${this.apiUrl}/subscriptions/${e}/leave`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!r.ok)throw Error(`API error: ${r.status}`)}catch(e){throw console.error("Error leaving pool:",e),e}}async transformPools(e){let s=e.map(e=>this.getServiceInfo(e.serviceId)),t=await Promise.all(s),r=new Map;return t.forEach(e=>r.set(e.id,e)),e.map(e=>{let s=new Date,t=new Date(s);t.setMonth(s.getMonth()+1);let o={id:e.userId,name:"Pool Creator",isPrimary:!0},l=r.get(e.serviceId)||{id:e.serviceId,name:e.name||"Subscription Service",logoUrl:"/assets/logos/default.svg",color:"#6366f1"};return{id:e.poolId,serviceName:l.name,serviceLogo:l.logoUrl,serviceColor:l.color,plan:"Standard Plan",totalCost:parseFloat(e.costPerSlot)*e.slotsTotal,splitCost:parseFloat(e.costPerSlot),members:[o],capacity:e.slotsTotal,slotsAvailable:e.slotsAvailable,expiresAt:t.toISOString(),status:e.isActive?"active":"expired",lastPayment:e.updatedAt}})}}let o=new r}};